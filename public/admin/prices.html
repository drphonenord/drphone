<!DOCTYPE html>
<html lang="fr">
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Prix par état</title>
<style>
  body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:#0b1222;color:#e5e7eb}
  header{padding:16px 20px;border-bottom:1px solid #1f2937}
  main{max-width:1100px;margin:0 auto;padding:20px}
  table{width:100%;border-collapse:collapse;margin-top:12px} th,td{padding:8px;border-bottom:1px solid #1f2937;text-align:left}
  input,button{padding:10px 12px;border-radius:10px;border:1px solid #1f2937;background:#0a1020;color:#e5e7eb}
  .btn{background:#111827;border:1px solid #1f2937}
</style></head>
<body>
<header><a href="/admin/dashboard.html" style="color:#93c5fd;text-decoration:none">← Dashboard</a> | Prix</header>
<main>
  <table><thead><tr><th>État</th><th>Min (€)</th><th>Max (€)</th></tr></thead><tbody id="tbody"></tbody></table>
  <div style="margin-top:12px"><button class="btn" onclick="save()">Enregistrer</button></div>
</main>
<script>
  const KEY='drphone_admin_token';
  const url='/.netlify/functions/prices_states';
  function render(data){
    const tb = document.getElementById('tbody'); tb.innerHTML='';
    (data.states||[]).forEach((row, i)=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td><input value="${row.state||''}" data-i="${i}" data-k="state"/></td>
                    <td><input type="number" value="${row.priceMin||0}" data-i="${i}" data-k="priceMin"/></td>
                    <td><input type="number" value="${row.priceMax||0}" data-i="${i}" data-k="priceMax"/></td>`;
      tb.appendChild(tr);
    });
  }
  async function load(){ const res=await fetch(url); render(await res.json()); }
  async function save(){
    const token = localStorage.getItem(KEY)||'';
    const rows = Array.from(document.querySelectorAll('#tbody tr')).map(tr=>{
      const ins = tr.querySelectorAll('input'); const obj={};
      ins.forEach(inp=>{ const k=inp.dataset.k; obj[k]=k==='state'?inp.value:Number(inp.value) });
      return obj;
    });
    await fetch(url, { method:'PUT', headers:{'Content-Type':'application/json','x-admin-token':token}, body:JSON.stringify({states:rows}) });
    load();
  }
  load();
</script>
</body></html>
