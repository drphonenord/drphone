<!DOCTYPE html>
<html lang="fr">
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Réparations</title>
<style>
  body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:#0b1222;color:#e5e7eb}
  header{padding:16px 20px;border-bottom:1px solid #1f2937}
  main{max-width:1100px;margin:0 auto;padding:20px}
  .row{display:flex;gap:8px;margin:8px 0}
  input,button{padding:10px 12px;border-radius:10px;border:1px solid #1f2937;background:#0a1020;color:#e5e7eb}
  table{width:100%;border-collapse:collapse;margin-top:12px} th,td{padding:8px;border-bottom:1px solid #1f2937;text-align:left}
  .btn{background:#111827;border:1px solid #1f2937}
</style></head>
<body>
<header><a href="/admin/dashboard.html" style="color:#93c5fd;text-decoration:none">← Dashboard</a> | Réparations</header>
<main>
  <div class="row">
    <input id="client" placeholder="Client" style="flex:1">
    <input id="device" placeholder="Appareil (ex: iPhone 13)">
    <input id="issue" placeholder="Panne (ex: écran)">
    <button class="btn" onclick="add()">Ajouter</button>
  </div>
  <table><thead><tr><th>Client</th><th>Appareil</th><th>Panne</th><th>Date</th></tr></thead><tbody id="tbody"></tbody></table>
</main>
<script>
  const KEY='drphone_admin_token';
  const url='/.netlify/functions/repairs';
  async function load(){
    const res = await fetch(url);
    const data = await res.json();
    const tb = document.getElementById('tbody'); tb.innerHTML='';
    data.forEach(c=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${c.client||''}</td><td>${c.device||''}</td><td>${c.issue||''}</td><td>${c.createdAt||''}</td>`;
      tb.appendChild(tr);
    });
  }
  async function add(){
    const token = localStorage.getItem(KEY)||'';
    const body = { client:document.getElementById('client').value, device:document.getElementById('device').value, issue:document.getElementById('issue').value };
    await fetch(url, { method:'POST', headers:{'Content-Type':'application/json','x-admin-token':token}, body:JSON.stringify(body) });
    document.getElementById('client').value=''; document.getElementById('device').value=''; document.getElementById('issue').value='';
    load();
  }
  load();
</script>
</body></html>
