<!doctype html><html lang='fr'><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'><title>Ticket · Admin</title>
<style>body{font-family:system-ui;max-width:900px;margin:0 auto;padding:16px;background:#0b1222;color:#e5e7eb}input,select,textarea,button{padding:10px;border-radius:10px;border:1px solid #1f2937;background:#0a1020;color:#e5e7eb}.row{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:10px 0}</style>
<body><h1>Ticket · Admin</h1><p><a href='/admin/dashboard.html' style='color:#93c5fd'>← Admin</a></p><div id='view'></div>
<div class='row'><div><label>Code</label><input id='code'></div><div><label>Statut</label><select id='status'><option>Réceptionné</option><option>En diagnostic</option><option>En cours</option><option>Pièce en commande</option><option>En test</option><option>Prêt · à restituer</option><option>Restitué</option></select></div></div>
<div class='row'><div><label>Modèle</label><input id='model'></div><div><label>Client</label><input id='client'></div></div><label>Note</label><textarea id='note' rows='5' style='width:100%'></textarea>
<div style='margin-top:10px;display:flex;gap:8px;flex-wrap:wrap'><button id='save'>Enregistrer</button><a id='suivi' target='_blank' style='color:#93c5fd'>Lien suivi</a></div>
<script>
const FN='/.netlify/functions/tickets';const params=new URLSearchParams(location.search);const KEY='drp_admin_token';const token=localStorage.getItem(KEY)||'';
async function load(){const code=params.get('code');if(!code){document.getElementById('view').textContent='Aucun code fourni.';return;}const r=await fetch(FN+'?code='+encodeURIComponent(code));const j=await r.json();if(!r.ok){document.getElementById('view').textContent='Introuvable';return;}const t=j.item;codeEl().value=t.code;statusEl().value=t.status||'Réceptionné';modelEl().value=t.model||'';clientEl().value=t.client||'';noteEl().value=t.note||'';document.getElementById('suivi').href='/suivi.html#'+encodeURIComponent(t.code);}function codeEl(){return document.getElementById('code')}function statusEl(){return document.getElementById('status')}function modelEl(){return document.getElementById('model')}function clientEl(){return document.getElementById('client')}function noteEl(){return document.getElementById('note')}
document.getElementById('save').onclick=async()=>{const body={code:codeEl().value.trim(),status:statusEl().value,model:modelEl().value.trim(),client:clientEl().value.trim(),note:noteEl().value.trim()};const r=await fetch(FN,{method:'POST',headers:{'Content-Type':'application/json','x-admin-token':token},body:JSON.stringify(body)});const j=await r.json();if(!r.ok||!j.ok){alert('Erreur '+(j.error||r.status));return;}alert('Sauvegardé');};load();
</script></body></html>